<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>lala</title>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <style type="text/css">
        div.bar {
            display: inline-block;
            width: 20px;
            margin-right: 2px;
        }
    </style>
</head>
<body>
<script type="text/javascript">
    //(1)链接数组
    var nodeset=[] ;//(1)数组初始化

    //(2)加载csv数据
    d3.csv("node.CSV",function(error,data){
        if(error){
            console.log(error);
        }else {
            //(3)取出其中的数字，和类别名
            for (var i = 0; i < data.length; i++) {
                var color = "#130c0e";
                var r = 0;
                switch (data[i].position){
                    case "Director":
                        color = "#ef5b9c";
                        r = 40;
                        break;
                    case "CEO":
                        color = "#3e4145";
                        r = 30;
                        break;
                    case "Business Development Manager":
                        color = "#987165";
                        r = 25;
                        break;
                    case "Business Support Manager":
                        color = "#ed1941";
                        r = 25;

                        break;
                    case "Business Control Manager":
                        color = "#f26522";
                        r = 25;

                        break;
                    case "Sales Department Leader":
                        color = "#d2553d";
                        r = 20;

                        break;
                    case "Product Department Leader":
                        color = "#853f04";
                        r = 20;

                        break;
                    case "Marketing Department Leader":
                        color = "#7a1723";
                        r = 20;

                        break;
                    case "Project Office Leader":
                        color = "#78331e";
                        r = 20;

                        break;
                    case "Professional Service Leader":
                        color = "#f15a22";
                        r = 20;

                        break;
                    case "QA Leader":
                        color = "#cbc547";
                        r = 20;

                        break;
                    case "Design Office Leader":
                        color = "#ffe600";
                        r = 20;

                        break;
                    case "Technical Support Office Leader":
                        color = "#705628";
                        r = 20;

                        break;
                    case "Software Development Leader":
                        color = "#fedcbd";
                        r = 20;

                        break;
                    case "Legal Office Leader":
                        color = "#b2d235";
                        r = 20;

                        break;
                    case "Finance Office Leader":
                        color = "#1d953f";
                        r = 20;

                        break;
                    case "HR Office Leader":
                        color = "#6950a1";
                        r = 20;

                        break;
                }
                nodeset.push({
                    id:data[i].id,
                    name:data[i].name,
                    postion:data[i].position,
                    corlor : color,
                    r:r
                });

            }

            var links = [
                {source: "0", target: "1", type: "licensing"    ,weight:1,color:143},
                {source: "0", target: "2", type: "licensing"       ,weight:1,color:143},
                {source: "1", target: "2", type: "suit"            ,weight:1,color:143},
                {source: "2", target: "3", type: "suit"           ,weight:2,color:243},
                {source: "2", target: "4", type: "resolved"          ,weight:2,color:243},
                {source: "2", target: "5", type: "suit"                ,weight:3,color:343},
                {source: "3", target: "6", type: "suit"              ,weight:4,color:443},
                {source: "3", target: "7", type: "suit" ,weight:5,color:543},
                {source: "3", target: "8", type: "suit"        ,weight:5,color:543},
                {source: "4", target: "9", type: "suit"            ,weight:6,color:643},
                {source: "4", target: "10", type: "suit"                ,weight:4,color:443},
                {source: "4", target: "11", type: "suit"       ,weight:5,color:543},
                {source: "4", target: "12", type: "resolved"        ,weight:7,color:743},
                {source: "4", target: "13", type: "resolved"             ,weight:4,color:443},
                {source: "4", target: "14", type: "suit"                ,weight:7,color:743},
                {source: "5", target: "15", type: "suit"                  ,weight:4,color:443},
                {source: "5", target: "16", type: "resolved"             ,weight:5,color:543},
                {source: "5", target: "17", type: "resolved"          ,weight:5,color:543},
                {source: "6", target: "7", type: "resolved"       ,weight:3,color:343},
                {source: "6", target: "8", type: "suit"           ,weight:5,color:543},
                {source: "7", target: "8", type: "suit"       ,weight:3,color:343},
                {source: "9", target: "10", type: "suit"       ,weight:4,color:443},
                {source: "9", target: "11", type: "suit"               ,weight:8,color:843},
                {source: "9", target: "12", type: "suit"             ,weight:4,color:443},
                {source: "9", target: "13", type: "resolved"        ,weight:2,color:243},
                {source: "9", target: "14", type: "suit"            ,weight:4,color:454},
                {source: "10", target: "11", type: "suit"                ,weight:7,color:754},
                {source: "10", target: "12", type: "suit"           ,weight:2,color:245},
                {source: "10", target: "12", type: "suit"           ,weight:4,color:445},
                {source: "10", target: "14", type: "suit"           ,weight:5,color:545},
                {source: "11", target: "12", type: "suit"           ,weight:5,color:545},
                {source: "11", target: "13", type: "suit"           ,weight:4,color:445},
                {source: "12", target: "14", type: "suit"           ,weight:3,color:345},
                {source: "15", target: "16", type: "suit"           ,weight:3,color:345},
                {source: "15", target: "17", type: "suit"           ,weight:4,color:445},
                {source: "16", target: "17", type: "suit"           ,weight:4,color:445},
                {source: "17", target: "7", type: "suit"           ,weight:3,color:345},
                {source: "16", target: "6", type: "suit"           ,weight:3,color:345},
                {source: "16", target: "7", type: "suit"           ,weight:4,color:545},
                {source: "16", target: "8", type: "suit"           ,weight:5,color:545},
                {source: "16", target: "9", type: "suit"           ,weight:1,color:145},
                {source: "16", target: "11", type: "suit"           ,weight:2,color:245},
                {source: "16", target: "13", type: "suit"           ,weight:2,color:245},
                {source: "16", target: "14", type: "suit"           ,weight:3,color:345},
                {source: "16", target: "10", type: "suit"           ,weight:2,color:245},
            ];

            var nodes = {};
            //(2)从链接中分离出不同的节点
            //一个小问题：节点的weight属性怎么产生的？
            links.forEach(function(link){  //思路就是：在连接中遍历链接，节点数组有了这个链接的源节点就把链接指向这个节点。没有的话把链接上的节点加到链接数组指定名称name属性，并把链接指向这个节点
//                link.source = nodes[link.source] //link.source就是节点值比如Apple
//                        || (nodes[link.source] = {name : link.source});//(填加节点数据)
//                link.target = nodes[link.target] || (nodes[link.target] = {name : link.target});
                link.source = nodes[link.source] || (nodes[link.source] = nodeset[link.source]);
                link.target = nodes[link.target] || (nodes[link.target] = nodeset[link.target]);

            });



            var width = 1350, height = 600;

            var force = d3.layout.force()
                    .nodes(d3.values(nodes))
                    .links(links)
                    .size([width, height])
                    .linkDistance(100)
                    .charge(-800)
                    .on("tick", tick)
                    .start();

            var svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("height", height);
            //(3)为链接添加线
            var link = svg.selectAll(".link")
                    .data(force.links())
                    .enter().append("line")
                    .attr("class", "link");

            var colors=d3.scale.category20();

            link.style("stroke",function(d){//  设置线的颜色
                return colors(d.color);
            })
                    .style("stroke-width",function(d,i){//设置线的宽度
                        return d.weight;
                    });

            //(4)为链接添加节点
            var node = svg.selectAll(".node")
                    .data(force.nodes())
                    .enter().append("g")
                    .attr("class", "node")
                    .on("mouseover", mouseover)
                    .on("mouseout", mouseout)
                    .call(force.drag);


            //设置圆点的半径，圆点的度越大weight属性值越大，可以对其做一点数学变换
            function  radius (d){
                if(!d.weight){//节点weight属性没有值初始化为1（一般就是叶子了）
                    d.weight=1;
                }
                return Math.log(d.weight)*10;
            }
            node.append("circle")
                    .attr("r",function(d){  //设置圆点半径
//                        return radius (d);
                        return d.r;
                    })
                    .style("fill",function(d){ //设置圆点的颜色
//                        return colors(d.weight*d.weight*d.weight);
                        return d.corlor;
                    }) ;

            node.append("text")
                    .attr("x", 12)
                    .attr("dy", ".35em")
                    .style('font-weight', 'bold')
                    .text(function(d) { return d.name; });

            node.append("svg:title")
                    .text(function (d) {
                        return d.postion;
                    });

            function tick() {//打点更新坐标
                link
                        .attr("x1", function(d) { return d.source.x; })
                        .attr("y1", function(d) { return d.source.y; })
                        .attr("x2", function(d) { return d.target.x; })
                        .attr("y2", function(d) { return d.target.y; });

                node
                        .attr("transform", function(d) {
                            return "translate(" + d.x + "," + d.y + ")";
                        });
            }

            function mouseover() {
                d3.select(this).select("circle").transition()
                        .duration(750)
                        .attr("r", function(d){  //设置圆点半径
                            return d.r+10;
                        }) ;
            }

            function mouseout() {
                d3.select(this).select("circle").transition()
                        .duration(750)
                        .attr("r", function(d){  //恢复圆点半径
                            return d.r;
                        }) ;
            }


        }

        d3.select("div")

                .select("table").select("tr").selectAll("td").data(nodeset)
                .enter()
                .append("td")
                .style("background-color", function (d) {
                    console.log(d);
                    return d.corlor;
                }).style("width", "75px").style("height", "20px")
                .text(function (d) {
                    return d.postion;
        });

    });

</script>
<div>
    <h1>这个是管理职务与颜色对照表</h1>
    <table cellspacing="0" cellpadding="5"><tr>

    </tr></table>

</div>
</body>
</html>